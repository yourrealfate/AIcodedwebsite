<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Retro Center â€“ Enhanced</title>
  <style>
    /* Reset and base styles */
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      background: #101010;
      font-family: Arial, sans-serif;
      color: #fff;
    }
    /* Navigation Bar */
    #navBar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 60px;
      background: rgba(0, 0, 0, 0.9);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 10px;
      z-index: 50;
      box-shadow: 0 2px 5px rgba(0,0,0,0.5);
    }
    #navBar .nav-buttons { display: flex; align-items: center; }
    #navBar button {
      margin: 0 5px;
      padding: 8px 12px;
      font-size: 14px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background: #1c8adb;
      color: #fff;
    }
    #navBar button:hover { background: #166bb2; }
    /* Panels for Settings, Games, and Leaderboard */
    #settingsPanel, #gamesMenu, #leaderboardPanel {
      position: fixed;
      background: rgba(0,0,0,0.9);
      padding: 15px;
      border-radius: 8px;
      font-size: 14px;
      z-index: 40;
      box-shadow: 0 2px 10px rgba(0,0,0,0.5);
    }
    #settingsPanel { top: 70px; right: 10px; max-width: 250px; }
    #gamesMenu { top: 70px; left: 10px; max-width: 200px; }
    #leaderboardPanel { bottom: 10px; left: 10px; max-width: 300px; max-height: 300px; overflow-y: auto; }
    #settingsPanel label, #leaderboardPanel label { display: block; margin-top: 10px; }
    #settingsPanel input[type="color"],
    #settingsPanel input[type="range"],
    #settingsPanel select { width: 100%; margin-top: 5px; }
    /* Main container (for the search area) */
    #mainContainer {
      position: relative;
      z-index: 10;
      text-align: center;
      padding-top: 80px; /* space for nav bar */
    }
    #mainContainer h1 { margin-bottom: 20px; }
    .search-box {
      background: rgba(0, 0, 0, 0.65);
      padding: 20px;
      border-radius: 8px;
      display: inline-block;
      margin-bottom: 20px;
    }
    .search-box input[type="text"] {
      padding: 10px;
      width: 300px;
      font-size: 16px;
      border: none;
      border-radius: 4px;
      margin-right: 10px;
    }
    .search-box button,
    .search-box select {
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background: #1c8adb;
      color: #fff;
    }
    .search-box button:hover { background: #166bb2; }
    .search-box select { margin-bottom: 10px; }
    /* Game Container Styles (responsive full-screen) */
    .gameContainer {
      display: none;
      position: absolute;
      top: 60px;
      left: 0;
      width: 100vw;
      height: calc(100vh - 60px);
      background: #000;
      z-index: 20;
      text-align: center;
    }
    .gameContainer canvas {
      background: #111;
      max-width: 90%;
      max-height: 90%;
      margin: auto;
      display: block;
    }
    .gameContainer button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 4px;
      background: #1c8adb;
      color: #fff;
      cursor: pointer;
    }
    .gameContainer button:hover { background: #166bb2; }
    /* Flappy Bird Start Overlay */
    #flappyStartOverlay {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 30;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    /* Flappy Bird Score Display */
    #flappyScoreDisplay {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 20px;
      color: #fff;
      z-index: 35;
    }
    /* Leaderboard list style */
    .leaderboard-list { list-style-type: decimal; padding-left: 20px; }
    .leaderboard-list li { margin-bottom: 5px; }
  </style>
</head>
<body>
  <!-- Navigation Bar -->
  <div id="navBar">
    <div class="nav-buttons">
      <button id="homeBtn">Home</button>
    </div>
    <div class="nav-buttons">
      <button id="nettleBtn">NettleWeb</button>
      <button id="toggleSettingsBtn">Settings</button>
      <button id="gamesBtn">Games</button>
      <button id="leaderboardBtn">Leaderboard</button>
    </div>
  </div>

  <!-- Settings Panel -->
  <div id="settingsPanel">
    <strong>Customize Look</strong>
    <label for="bgColorPicker">Page Background Color:</label>
    <input type="color" id="bgColorPicker" value="#101010">
    <label for="bgBrightnessSlider">Background Brightness:</label>
    <input type="range" id="bgBrightnessSlider" min="0.5" max="1.5" step="0.01" value="1">
    <label for="textboxColorPicker">Textbox Color:</label>
    <input type="color" id="textboxColorPicker" value="#ffffff">
    <label for="shapeColorPicker">Floating Shape Color:</label>
    <input type="color" id="shapeColorPicker" value="#ffffff">
    <label for="shapeTypeSelect">Shape Type:</label>
    <select id="shapeTypeSelect">
      <option value="circle">Circle</option>
      <option value="square">Square</option>
    </select>
    <label for="shapeCountSlider">Number of Shapes:</label>
    <input type="range" id="shapeCountSlider" min="10" max="50" step="1" value="20">
    <label for="flappyBgPicker">Flappy Bird BG Color:</label>
    <input type="color" id="flappyBgPicker" value="#70c5ce">
  </div>

  <!-- Games Menu -->
  <div id="gamesMenu">
    <strong>Games</strong>
    <button id="flappyBtn">Flappy Bird</button>
    <button id="snakeBtn">Snake</button>
    <button id="pacmanBtn">Pacman</button>
    <button id="closeGamesBtn">Close</button>
  </div>

  <!-- Leaderboard Panel -->
  <div id="leaderboardPanel">
    <strong>Leaderboard</strong>
    <div id="leaderboardContent"></div>
    <button id="refreshLeaderboardBtn">Refresh Leaderboard</button>
  </div>

  <!-- Main Container (Retro Games Search) -->
  <div id="mainContainer">
    <h1>Retro Games</h1>
    <div class="search-box">
      <label for="proxySelect">Choose Proxy:</label>
      <select id="proxySelect">
        <option value="">None</option>
        <option value="https://holyunblocker.org/?go=">Holy Unblocker</option>
        <option value="https://titanium-proxy.example.com/?go=">Titanium Proxy</option>
      </select>
      <br><br>
      <input type="text" id="searchInput" placeholder="Enter URL or search query..." required>
      <button id="searchBtn">Go</button>
    </div>
  </div>

  <!-- Flappy Bird Game Container -->
  <div class="gameContainer" id="flappyGame">
    <h2>Flappy Bird</h2>
    <canvas id="flappyCanvas"></canvas>
    <!-- Start Overlay -->
    <div id="flappyStartOverlay">
      <button id="flappyStartBtn" style="padding:10px 20px; font-size:18px;">Start</button>
    </div>
    <div style="margin-top:10px;">
      <button id="flappyRestartBtn" style="display:none;">Restart</button>
    </div>
    <div id="flappyScoreDisplay"></div>
  </div>

  <!-- Snake Game Container -->
  <div class="gameContainer" id="snakeGame">
    <h2>Snake</h2>
    <canvas id="snakeCanvas"></canvas>
    <br>
    <button id="snakeRestartBtn" style="display:none;">Restart</button>
  </div>

  <!-- Pacman Game Container -->
  <div class="gameContainer" id="pacmanGame">
    <h2>Pacman</h2>
    <canvas id="pacmanCanvas"></canvas>
    <br>
    <button id="pacmanRestartBtn" style="display:none;">Restart</button>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      /* === Responsive Canvas Sizing === */
      function setCanvasSize(canvas, widthFactor, heightFactor) {
        // Use a percentage of viewport (minus nav bar height ~60px)
        canvas.width = Math.floor(window.innerWidth * widthFactor);
        canvas.height = Math.floor((window.innerHeight - 60) * heightFactor);
      }
      function resizeAllCanvases() {
         setCanvasSize(document.getElementById("flappyCanvas"), 0.9, 0.9);
         setCanvasSize(document.getElementById("snakeCanvas"), 0.9, 0.9);
         setCanvasSize(document.getElementById("pacmanCanvas"), 0.9, 0.9);
      }
      resizeAllCanvases();
      window.addEventListener("resize", resizeAllCanvases);

      /* === Navigation Button Listeners === */
      document.getElementById("homeBtn").addEventListener("click", function() {
        stopCurrentGame();
        hideAllGameContainers();
        document.getElementById("mainContainer").style.display = "block";
      });
      document.getElementById("nettleBtn").addEventListener("click", function() {
        window.open("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiID8+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTI4MCIgaGVpZ2h0PSI3MjAiIHZpZXdCb3g9IjAgMCAxMjgwIDcyMCI+Cgk8dGl0bGU+R29vZ2xlPC90aXRsZT4KCTxmb3JlaWduT2JqZWN0IHg9IjAiIHk9IjAiIHdpZHRoPSIxMjgwIiBoZWlnaHQ9IjcyMCI+CgkJPGVtYmVkIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBzcmM9Imh0dHBzOi8vbmV0dGxld2ViLmNvbS8iIHR5cGU9InRleHQvcGxhaW4iIHdpZHRoPSIxMjYwIiBoZWlnaHQ9IjcwMCIgLz4KCTwvZm9yZWduT2JqZWN0Pgo8L3N2Zz4=", "_blank");
      });
      document.getElementById("toggleSettingsBtn").addEventListener("click", function() {
        let panel = document.getElementById("settingsPanel");
        panel.style.display = (panel.style.display === "none" || panel.style.display === "") ? "block" : "none";
      });
      document.getElementById("gamesBtn").addEventListener("click", function() {
        let menu = document.getElementById("gamesMenu");
        menu.style.display = (menu.style.display === "none" || menu.style.display === "") ? "block" : "none";
      });
      document.getElementById("closeGamesBtn").addEventListener("click", function() {
        document.getElementById("gamesMenu").style.display = "none";
      });
      document.getElementById("leaderboardBtn").addEventListener("click", function() {
        let lb = document.getElementById("leaderboardPanel");
        lb.style.display = (lb.style.display === "none" || lb.style.display === "") ? "block" : "none";
        refreshLeaderboard();
      });
      document.getElementById("refreshLeaderboardBtn").addEventListener("click", refreshLeaderboard);
      
      /* === Search Functionality === */
      document.getElementById("searchBtn").addEventListener("click", function() {
        let query = document.getElementById("searchInput").value.trim();
        if (!query) return;
        let targetUrl = query;
        if (!/^https?:\/\//i.test(query)) {
          if (query.indexOf(" ") !== -1 || query.indexOf(".") === -1)
            targetUrl = "https://www.google.com/search?q=" + encodeURIComponent(query);
          else
            targetUrl = "https://" + query;
        }
        let proxyBase = document.getElementById("proxySelect").value;
        if (proxyBase) { targetUrl = proxyBase + encodeURIComponent(targetUrl); }
        let newWin = window.open("about:blank", "_blank");
        newWin.document.write(`<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="refresh" content="0; url=${targetUrl}">
  <title>Redirecting...</title>
</head>
<body>
  <p>Redirecting, please wait...</p>
</body>
</html>`);
        newWin.document.close();
      });
      
      /* === Floating Shapes === */
      function generateShapes() {
        document.querySelectorAll('.shape').forEach(elem => elem.remove());
        let count = parseInt(document.getElementById("shapeCountSlider").value);
        let color = document.getElementById("shapeColorPicker").value;
        let type = document.getElementById("shapeTypeSelect").value;
        for (let i = 0; i < count; i++) {
          let shape = document.createElement("div");
          shape.className = "shape";
          let size = Math.floor(Math.random()*50) + 20;
          shape.style.width = size + "px";
          shape.style.height = size + "px";
          shape.style.left = Math.random()*window.innerWidth + "px";
          shape.style.top = Math.random()*window.innerHeight + "px";
          shape.style.animationDuration = (Math.random()*20+10) + "s";
          shape.style.animationDelay = (Math.random()*5) + "s";
          shape.style.backgroundColor = color;
          shape.style.borderRadius = (type === "circle" ? "50%" : "0%");
          document.body.appendChild(shape);
        }
      }
      generateShapes();
      window.addEventListener("resize", generateShapes);
      document.getElementById("bgColorPicker").addEventListener("input", function(){
        document.body.style.backgroundColor = this.value;
      });
      document.getElementById("bgBrightnessSlider").addEventListener("input", function(){
        document.body.style.filter = "brightness(" + this.value + ")";
      });
      document.getElementById("textboxColorPicker").addEventListener("input", function(){
        document.getElement
